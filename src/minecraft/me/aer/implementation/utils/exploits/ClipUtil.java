package me.aer.implementation.utils.exploits;

import com.darkmagician6.eventapi.EventManager;
import com.darkmagician6.eventapi.EventTarget;
import me.aer.implementation.utils.Utilities;
import me.aer.implementation.utils.player.PlayerUtil;
import me.aer.implementation.utils.world.WorldUtil;
import me.aer.injection.events.entity.EventPreEntityUpdate;
import me.aer.visual.render.ChatColour;
import me.aer.visual.render.ChatUtils;
import net.minecraft.network.play.client.CPacketPlayer;

public class ClipUtil implements Utilities {

	private static double distanceV;
	private static double distanceH;
	private static boolean run;
	private static boolean msg;
	private static String direction;


    public ClipUtil() {
		EventManager.register(this);
	}


	public boolean Clip(double distanceHIn, double distanceVIn, boolean msgIn, boolean checkBlocks) {
		boolean flag = true;
		direction = PlayerUtil.direction(minecraft.player);
		distanceH = distanceHIn;
		distanceV = distanceVIn;
		msg = msgIn;
		if (checkBlocks) {
			double check = checkForBlocksAndUpdate(distanceH, direction);
			if (check != distanceH) {
				distanceH = check;
				flag = false;
			}
		}
		run = true;
		return flag;
	}

	public boolean Clip(double distanceHIn, double distanceVIn, boolean msgIn, boolean checkBlocks, String directionIn) {
		boolean flag = true;
		direction = directionIn;
		distanceH = distanceHIn;
		distanceV = distanceVIn;
		msg = msgIn;
		if (checkBlocks) {
			double check = checkForBlocksAndUpdate(distanceH, direction);
			if (check != distanceH) {
				distanceH = check;
				flag = false;
			}
		}
		run = true;
		return flag;
	}


	@EventTarget
	public void onEntityLivingUpdateStart(EventPreEntityUpdate event) {
		if (minecraft.world != null && minecraft.player != null) {
			if (!run) {
				return;
			}
			if (direction.equalsIgnoreCase("south")) {
				minecraft.player.connection.sendPacket(new CPacketPlayer.Position(minecraft.player.posX, minecraft.player.posY, minecraft.player.posZ + 0.0010000000474974513, true));
				minecraft.player.setPosition(minecraft.player.posX, minecraft.player.posY + distanceV, minecraft.player.posZ + distanceH);
			}
			if (direction.equalsIgnoreCase("north")) {
				minecraft.player.connection.sendPacket(new CPacketPlayer.Position(minecraft.player.posX, minecraft.player.posY, minecraft.player.posZ - 0.0010000000474974513, true));
				minecraft.player.setPosition(minecraft.player.posX, minecraft.player.posY + distanceV, minecraft.player.posZ - distanceH);
			}
			if (direction.equalsIgnoreCase("east")) {
				minecraft.player.connection.sendPacket(new CPacketPlayer.Position(minecraft.player.posX + 0.0010000000474974513, minecraft.player.posY, minecraft.player.posZ, true));
				minecraft.player.setPosition(minecraft.player.posX + distanceH, minecraft.player.posY + distanceV, minecraft.player.posZ);
			}
			if (direction.equalsIgnoreCase("west")) {
				minecraft.player.connection.sendPacket(new CPacketPlayer.Position(minecraft.player.posX - 0.0010000000474974513, minecraft.player.posY, minecraft.player.posZ, true));
				minecraft.player.setPosition(minecraft.player.posX - distanceH, minecraft.player.posY + distanceV, minecraft.player.posZ);
			}
			if (msg) {
				ChatUtils.sendChatMessage("Clipped!", ChatColour.lightPurple, "CMD", true);
			}
			run = false;
		}

	}


	public static double checkForBlocksAndUpdate(double distIn, String direction) {
		double dist = 0;
		double posX = minecraft.player.posX;
		double posZ = minecraft.player.posZ;
		double posY = minecraft.player.posY;
		if (distIn < 0) {
			while (dist > distIn) {
				if (direction.equalsIgnoreCase("NORTH")) {
					posZ += 1;
				} else if (direction.equalsIgnoreCase("EAST")) {
					posX -= 1;
				} else if (direction.equalsIgnoreCase("SOUTH")) {
					posZ -= 1;
				} else if (direction.equalsIgnoreCase("WEST")) {
					posX += 1;
				}

				if (WorldUtil.isSpaceForPlayerAt(posX, posY, posZ)) {
					return dist;
				}

				dist--;

			}
		} else {
			while (dist < distIn) {
				if (direction.equalsIgnoreCase("NORTH")) {
					posZ -= 1;
				} else if (direction.equalsIgnoreCase("EAST")) {
					posX += 1;
				} else if (direction.equalsIgnoreCase("SOUTH")) {
					posZ += 1;
				} else if (direction.equalsIgnoreCase("WEST")) {
					posX -= 1;
				}

				if (WorldUtil.isSpaceForPlayerAt(posX, posY, posZ)) {
					return dist;
				}

				dist++;

			}
		}
		return dist;
	}

}
